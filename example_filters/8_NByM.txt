// copy & paste into playground for testing

const WIDTH = getVideoWidth();
const HEIGHT = getVideoHeight();

function create_grid(COLS, ROWS){
    function grid(src, dest){
        var width = math_floor(WIDTH / COLS);
        var horiz_bounds = COLS * width;
        
        var height = math_floor(HEIGHT / ROWS);
        var vert_bounds = ROWS * height;
        
        for (var i=0; i<WIDTH; i = i+1){
            for (var j=0; j<HEIGHT; j = j+1){
                if (j >= vert_bounds){
                    if (i >= horiz_bounds){
                        copy_pixel(src[i][j], dest[i][j]);
                    } else {
                        //i = n * width + e
                        var e = i % width;
                        var n = (i-e) / width;
                        copy_pixel(src[e * COLS + n][j], dest[i][j]);
                    }
                } else {
                    //j = m * height + d
                    var m = math_floor(j / height);
                    var d = j % height;
                    if (i >= horiz_bounds){
                        copy_pixel(src[i][d * ROWS + m], dest[i][j]);
                    } else {
                        var e = i % width;
                        var n = (i-e) / width;
                        copy_pixel(src[e * COLS + n][d * ROWS + m], dest[i][j]);
                    }
                }
            }
        }
    }
    return grid;
}
apply_filter(create_grid(4,3));
